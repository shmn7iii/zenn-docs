---
title: "Tapyrusã®COLORè­˜åˆ¥å­ã«ã¤ã„ã¦"
emoji: "ğŸ’­"
type: "tech"
topics: ["Tapyrus"]
published: false
---

# Tapyrus ã® COLOR è­˜åˆ¥å­ã«ã¤ã„ã¦

å°±æ´»ãƒ¢ãƒãƒ™ãŒå¹ãé£›ã‚“ã ã®ã§è¶£å‘³ã«èµ°ã‚Šã¾ã™ã€‚
Tapyrus ã® COLOR è­˜åˆ¥å­ã«ã¤ã„ã¦ã€è»½ãã¾ã¨ã‚ã‚‹è¨˜äº‹ã€‚

# COLOR è­˜åˆ¥å­ã¨ã¯

Tapyrus ã§ç™ºè¡Œã•ã‚Œã‚‹ Token ãªã©ã«å¯¾ã—ã€è­˜åˆ¥å­ã¨ã—ã¦ä»˜ä¸ã•ã‚Œã‚‹ã€‚OP_COLOR ä»¥å¾Œã«è¨˜è¼‰ã•ã‚Œã€ã“ã® opcode ãŒå‡ºç¾ã™ã‚‹ã“ã¨ã§ã‚¹ã‚¿ãƒƒã‚¯æœ€ä¸Šä½ã®è¦ç´ ãŒ COLOR è­˜åˆ¥å­ã¨ã—ã¦è§£é‡ˆã•ã‚Œã‚‹ã€‚ã¾ãŸã€ãã® UTXO ã¯ä»»æ„ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç¤ºã™ã“ã¨ã¨ãªã‚‹ã€‚

tapyrus-cli ã«ã¦ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã™ã‚‹ã¨

```bash
{
  "color": "c3fe867030bbc10029a2d11a7ef4719a4b6ef11e5bdbe0d023bd5a57732c48cf99",
  "txid": "28618a610078b4460b8302e3cc4a1e822b600024b399ede7815de9b830a4a83a"
}
```

ã®ã‚ˆã†ãªå½¢ã§å‡ºåŠ›ãŒè¿”ã‚‹ãŒã€ã“ã®`color`è¦ç´ ãŒ COLOR è­˜åˆ¥å­ã§ã‚ã‚‹ã€‚

ç«¯çš„ã« Token ã® ID ã¨è§£é‡ˆã§ãã‚‹ã€‚

## COLOR è­˜åˆ¥å­ã®æ§‹é€ 

COLOR è­˜åˆ¥å­ã¯ 1 ãƒã‚¤ãƒˆã®ã€Œã‚¿ã‚¤ãƒ—ï¼ˆTYPEï¼‰ã€ã¨ 32 ãƒã‚¤ãƒˆã®ã€Œãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ï¼ˆPAYLOADï¼‰ã€ã§æ§‹æˆã•ã‚Œã‚‹ã€‚ã‚¿ã‚¤ãƒ—ã¨ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®å†…å®¹ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚

| ã‚¿ã‚¤ãƒ— | å®šç¾©                 | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰                                       |
| ------ | -------------------- | ------------------------------------------------ |
| 0xC1   | Reissuable Token     | ç™ºè¡Œ TX ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã® scriptPubkey ã® SHA256 å€¤ |
| 0xC2   | Non-Reissuable Token | ç™ºè¡Œ TX ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã® OutPoint ã® SHA256 å€¤     |
| 0xC3   | Non-Fungible Token   | ç™ºè¡Œ TX ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã® OutPoint ã® SHA256 å€¤     |

ç™ºè¡Œ TX ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã® OutPointã€ã¤ã¾ã‚Šç™ºè¡Œã«ç”¨ã„ã‚‹ UTXO ã¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã§ä¸€æ„ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ COLOR è­˜åˆ¥å­ã‚‚ä¸€æ„ãªã‚‚ã®ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚ã¾ãŸã“ã‚Œã«ã‚ˆã‚Š UTXO å˜ä½“ã§ COLOR è­˜åˆ¥å­ã‚’å°å‡ºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚‹ã€‚

## COLOR è­˜åˆ¥å­ã‚’å°å‡ºã—ã¦ã¿ã‚‹

NFT ã®ç™ºè¡Œã‚’ä¾‹ã¨ã—ã¦å°å‡ºã—ã¦ã¿ã‚‹ã€‚

ç™ºè¡Œã«ç”¨ã„ã‚‹ UTXO ã¯ä»¥ä¸‹ã¨ã™ã‚‹ã€‚

**UTXO-01**

```bash
{
  "txid": "08504c03b29073a8ad8705363c7fcb2708afac2e1f11453bd7f64d9d365f269d",
  "vout": 0,
  "address": "1EjNxzpqw411MfY8i2HFLHjDvUERfR9VLj",
  "token": "TPC",
  "amount": 0.00050000,
  "label": "",
  "scriptPubKey": "76a914969d7101a2c2aa9b25310785ecfa837e1220df7988ac",
  "confirmations": 7660,
  "spendable": true,
  "solvable": true,
  "safe": true
},
```

### ã‚¿ã‚¤ãƒ—

ã‚¿ã‚¤ãƒ—ã«ã¤ã„ã¦ã€NFT ã‚’ç™ºè¡Œã™ã‚‹ã®ã§ã€Œ`0xC3`ï¼ˆ16 é€²æ•°è¡¨ç¤ºã§ `c3` ï¼‰ã€ã¨ãªã‚‹ã€‚

### ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰

ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®å†…å®¹ã¯ã€Œç™ºè¡Œ TX ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã® OutPoint ã® SHA256 å€¤ã€ã§ã‚ã‚‹ã€‚

ã€Œç™ºè¡Œ TXã€ã¯ä»Šã‹ã‚‰ä½œã‚‹ï¼ˆ`tapyrus-cli issuetoken`ã§ç”Ÿæˆã•ã‚Œã‚‹ï¼‰ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ã“ã¨ã€‚
ã€Œç™ºè¡Œ TX ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã€ã¯ç™ºè¡Œã«ç”¨ã„ã‚‹ UTXOã€‚ã¤ã¾ã‚Šä¸Šè¨˜ã§ç¤ºã—ãŸ**UTXO-01**ã€‚

**UTXO-01**ã®ã‚¢ã‚¦ãƒˆãƒã‚¤ãƒ³ãƒˆã‚’å°å‡ºã™ã‚‹ã€‚å°å‡ºã«ã¯ tapyrusrb ã‚’ç”¨ã„ã‚‹ã€‚

```ruby
$ irb

# tapyrusrbã‚’å°å…¥
irb(main):001:0> require 'tapyrus'
=> true

# TXID
irb(main):002:0> txid = '08504c03b29073a8ad8705363c7fcb2708afac2e1f11453bd7f64d9d365f269d'
=> "08504c03b29073a8ad8705363c7fcb2708afac2e1f11453bd7f64d9d365f269d"

# index
irb(main):003:0> index = 0
=> 0

# TXIDã‹ã‚‰ã‚¢ã‚¦ãƒˆãƒã‚¤ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆ
irb(main):004:0> out_point = Tapyrus::OutPoint.from_txid(txid, index)
=> #<Tapyrus::OutPoint:0x00000001045a6388 @index=0, @tx_hash="9d265f369d4df6d73b45111f2eacaf0827cb7f3c360587ada87390b2034c5008">

# ã‚¢ã‚¦ãƒˆãƒã‚¤ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å–å¾—
irb(main):005:0> out_point_payload = out_point.to_payload
=> "\x9D&_6\x9DM\xF6\xD7;E\x11\x1F.\xAC\xAF\b'\xCB\x7F<6\x05\x87\xAD\xA8s\x90\xB2\x03LP\b\x00\x00\x00\x00"

# ã‚¢ã‚¦ãƒˆãƒã‚¤ãƒ³ãƒˆã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®SHA256å€¤ã‚’æ±‚ã‚ã€ãƒã‚¤ãƒŠãƒªã‚’Hexã«å¤‰æ›
irb(main):006:0> Tapyrus::sha256(out_point_payload).bth
=> "47b0042d422289833b5c74b169efcd54f16aa0de97085fb12c787222f7ded1c7"
```

ã“ã‚Œã§ COLOR è­˜åˆ¥å­ã®ã€Œãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã€ãŒ

```
47b0042d422289833b5c74b169efcd54f16aa0de97085fb12c787222f7ded1c7
```

ã§ã‚ã‚‹ã“ã¨ãŒå¾—ã‚‰ã‚ŒãŸã€‚

### COLOR è­˜åˆ¥å­

ä¸Šè¨˜ã‚ˆã‚Šã€ã€Œã‚¿ã‚¤ãƒ—ã€ã¨ã€Œãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã€ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ COLOR è­˜åˆ¥å­ã¯

```
c347b0042d422289833b5c74b169efcd54f16aa0de97085fb12c787222f7ded1c7
```

ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã€‚ã“ã‚Œã§å°å‡ºã¯å®Œäº†ã€‚

### ç¢ºèª

å®Ÿéš›ã«ç™ºè¡Œã—ç¢ºèªã—ã¦ã¿ã‚‹ã€‚

```bash
$ tapyrus-cli issuetoken 3 1 08504c03b29073a8ad8705363c7fcb2708afac2e1f11453bd7f64d9d365f269d 0
{
  "color": "c347b0042d422289833b5c74b169efcd54f16aa0de97085fb12c787222f7ded1c7",
  "txid": "d8129bc7e3287bf38895cc203d8472d2e5888b94df189900b27f826d2f88eb4f"
}
```

å°å‡ºã—ãŸ COLOR è­˜åˆ¥å­ã¨åŒã˜ã‚‚ã®ãŒå‡ºåŠ›ã•ã‚ŒãŸã€‚å°å‡ºã¯æˆåŠŸã€‚

## è£œè¶³

ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®å°å‡ºã‚’ tapyrusrb ã«ä¸¸æŠ•ã’ã—ãŸã®ã§ä½¿ã‚ãšã‚„ã£ã¦ã¿ã‚‹ã€‚SHA256 ã¯æµçŸ³ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«é ¼ã‚‹ã€‚

```ruby
$ irb

# digestã‚’å°å…¥
irb(main):001:0> require "digest"
=> true

# TXID
irb(main):002:0> txid = '08504c03b29073a8ad8705363c7fcb2708afac2e1f11453bd7f64d9d365f269d'
=> "08504c03b29073a8ad8705363c7fcb2708afac2e1f11453bd7f64d9d365f269d"

# index
irb(main):003:0> index = 0
=> 0

# OutPointã®å°å‡º
irb(main):004:0> outpoint = [[txid].pack('H*').reverse, index].pack('a32V')
=> "\x9D&_6\x9DM\xF6\xD7;E\x11\x1F.\xAC\xAF\b'\xCB\x7F<6\x05\x87\xAD\xA8s\x90\xB2\x03LP\b\x00\x00\x00\x00"

# COLORè­˜åˆ¥å­ã®å°å‡º
irb(main):005:0> Digest::SHA256.digest(outpoint).unpack('H*').first
=> "47b0042d422289833b5c74b169efcd54f16aa0de97085fb12c787222f7ded1c7"
```

ã¾ã¨ã‚ã‚‹ã¨

OutPoint ã®å°å‡ºã¯

> TXID ã‚’ãƒã‚¤ãƒŠãƒªã«å¤‰æ›ã—ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã‚’åè»¢ã—ãŸã‚‚ã®ã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ pack ã™ã‚‹ã€‚pack ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ–‡å­—åˆ—ã®å†…å®¹ã¯ã€Œa: ASCII æ–‡å­—, 32: 32 ãƒã‚¤ãƒˆ, V: ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã® 32bit ç¬¦å·ãªã—æ•´æ•°ã€

COLOR è­˜åˆ¥å­ã®å°å‡ºã¯

> OutPoint ã® SHA256 å€¤ã‚’æ±‚ã‚ã€16 é€²æ•°æ–‡å­—åˆ—ã¸å¤‰æ›

# ä»¥ä¸Š

è‡ªå·±æº€ã®ã‚³ãƒ¼ãƒŠãƒ¼ã§ã—ãŸã€‚ç†è§£ã™ã‚‹ã¨ã¨ã¦ã‚‚å˜ç´”ãªæ§‹é€ ã€‚

### å‚è€ƒ

https://docs.ruby-lang.org/ja/latest/doc/pack_template.html

https://github.com/chaintope/tapyrusrb/blob/69ae2753841bf598c4e769f2f37cf4d067708ab1/lib/tapyrus/out_point.rb

---
title: "Tapyrus Coreã‚’devãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã™ã‚‹ ã€œUbuntuç·¨ã€œ"
emoji: "ğŸ›ï¸"
type: "tech"
topics: ["ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³", "ubuntu", "tapyrus"]
published: true
---

# Start Tapyrus-Core in dev mode on Ubuntu

ã“ã®è¨˜äº‹ã®ç›®æ¨™ã¯ã€ŒUbuntuä¸Šã§Tapyrusã®devãƒ¢ãƒ¼ãƒ‰ã‚’èµ·å‹•ã™ã‚‹ã€ã“ã¨ã§ã™ã€‚

Dockerã‚’ä½¿ã£ãŸæ§‹ç¯‰æ–¹æ³•ã¯[å‰å›ã®è¨˜äº‹](https://zenn.dev/shmn7iii/articles/53e533e2ac3756)ã‚’ã”è¦§ãã ã•ã„ã€‚

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä»¥ä¸‹ã§ã™ã€‚

https://github.com/chaintope/tapyrus-core/blob/master/doc/tapyrus/getting_started.md#how-to-start-tapyrus-in-dev-mode

# å‰æ

Ubuntu v18.04.6

:::message
Ubuntu 20.xä»¥é™ã ã¨ add-apt-repository ppa:bitcoin/bitcoin ã§ã‚¨ãƒ©ãƒ¼åãã¾ã™ã€‚ã“ã®å­ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã®ã¯BerkeleyDBãªã®ã§ç›´æ¥BDBã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ãŒãã“ã¾ã§ã—ã¦Ubuntu 20.xãŒä½¿ã„ãŸã„ã‚ã‘ã§ã‚‚ãªã„ã®ã§18.04.6ã‚’ä½¿ã„ã¾ã™ã€‚
:::


Tapyrus Core v0.5.0 rc1

:::message
v0.4.1ã§ã‚„ã£ã¦ã‚‹ã‚‚ã®ã ã¨æ€ã£ã¦ãŸã®ã§ã™ãŒæ°—ä»˜ã„ãŸã‚‰v0.5.0ã«ãªã£ã¦ã¾ã—ãŸã€‚2021/11/10æ™‚ç‚¹ã§æœ¬ãƒªãƒªãƒ¼ã‚¹ã§ã¯ãªã•ãã†ã§ã™ã€‚ãªã‚“ãªã‚‰9æ—¥ã«rc2ãŒå‡ºã¦ã¾ã—ãŸã€‚v0.5.0ã§ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå†…å®¹ç­‰å…¬å¼ã‹ã‚‰ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ãŒã‚ã£ãŸã‚‰ã¾ã¨ã‚ãŸã„ã§ã™(é¡˜æœ›)
:::

# Tapyrus Coreã‚’ãƒ“ãƒ«ãƒ‰

## ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
$ sudo apt-get install build-essential libtool autotools-dev automake pkg-config libevent-dev bsdmainutils python3 libboost-system-dev libboost-filesystem-dev libboost-chrono-dev libboost-test-dev libboost-thread-dev software-properties-common
$ sudo add-apt-repository ppa:bitcoin/bitcoin
$ sudo apt-get update
$ sudo apt-get install libdb4.8-dev libdb4.8++-dev
```

## ãƒ“ãƒ«ãƒ‰

```bash
$ git clone https://github.com/chaintope/tapyrus-core.git
$ cd tapyrus-core
$ ./autogen.sh
$ ./configure --without-gui
$ make
$ sudo make install
```

# ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ

ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯å„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŠã‚ˆã³ãƒ¢ãƒ¼ãƒ‰ã§ç•°ãªã‚‹ã‚‚ã®ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

```bash
$ sudo mkdir /var/lib/tapyrus-dev
```

# tapyrus.confã‚’ä½œæˆ

/etc/tapyrusé…ä¸‹ã«ä½œæˆã—ã¾ã™ã€‚

```bash
$ sudo mkdir /etc/tapyrus
$ cd /etc/tapyrus
$ sudo vim tapyrus.conf
```

å†…å®¹ã¯ä»¥ä¸‹ã¨ã—ã¾ã™ã€‚

```
networkid=1905960821
dev=1
[dev]
server=1
keypool=1
discover=0
bind=127.0.0.1

rpcuser=rpcuser
rpcpassword=rpcpassword
rpcbind=0.0.0.0
rpcallowip=127.0.0.1
```

# éµã‚’ç”Ÿæˆ

rubyã§éµã‚’ç”Ÿæˆã—ã¦ã„ãã¾ã™ã€‚å…¥ã£ã¦ãªã‘ã‚Œã°ä»¥ä¸‹ã®æ‰‹é †ã§å…¥ã‚Œã¦ãã ã•ã„ã€‚

```bash
# aptã®Rubyã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
$ sudo apt purge ruby rbenv ruby-build
$ rm -rf ~/.rbenv

# rbenv, ruby-buildã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
$ git clone https://github.com/rbenv/rbenv.git ~/.rbenv
$ git clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build

# bashrcã‚’æ›´æ–°
$ echo '# ruby' >> ~/.bashrc
$ echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bashrc
$ echo 'eval "$(rbenv init - )"' >> ~/.bashrc
$ source ~/.bashrc

# ruby 3.0.1 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
$ rbenv install 3.0.1

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’3.0.1ã«è¨­å®š
$ rbenv global 3.0.1

# ç¢ºèª
$ ruby -v
```

## 1. tapyrusrbã‚’ç”¨æ„ã™ã‚‹

Tapyrusã®Rubyç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€tapyrusrbã‚’gemã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
$ gem install tapyrus
```

ã“ã®å…ˆã¯irbã§æ“ä½œã—ã¦ã„ãã¾ã™ã€‚irbã¨ã¯Rubyã®å¯¾è©±å‹ã‚·ã‚§ãƒ«ã§ã™ã€‚

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§irbã‚’èµ·å‹•ã—ã¾ã™ã€‚

```bash
$ irb
```

irbã§ã¯ `>` ä»¥é™ã«å…¥åŠ›ã€ `=>` ä»¥é™ã«è¿”ç­”ãŒè¿”ã£ã¦ãã¾ã™ã€‚

irbã§tapyrusrbã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚`>` ä»¥é™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚`=>` ä»¥é™ãŒè¿”ã£ã¦æ¥ã‚Œã°æˆåŠŸã§ã™ã€‚

```ruby
> require 'tapyrus'
=> true
```

tapyrusrbã‚’devãƒ¢ãƒ¼ãƒ‰ã«è¨­å®šã—ã¾ã™ã€‚

```ruby
> Tapyrus.chain_params = :dev
=> true
```

## 2. æ‹¡å¼µéµã®seedã‚’å–å¾—

SHA-256ã§16é€²æ•°è¡¨ç¤ºã®æ‹¡å¼µéµã®seedã‚’å–å¾—ã—ã¾ã™ã€‚

æ‹¡å¼µéµã¨ã¯å…¬é–‹éµã‚„ç§˜å¯†éµãªã©ã‚’ä¿æŒã—ãŸå˜ä¸€ã®éµã§ã™ã€‚

```ruby
> OpenSSL::Digest::SHA256.hexdigest(SecureRandom.hex(32))
=> "æ‹¡å¼µéµ"
```

è¿”ç­”ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚

## 3. æ‹¡å¼µéµã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–

ä¸€ã¤å‰ã§å–å¾—ã—ãŸæ‹¡å¼µéµã‚’å¼•æ•°ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```ruby
> ext_key = Tapyrus::ExtKey.generate_master("æ‹¡å¼µéµ")
=> #<Tapyrus::ExtKey:0x00007fb299041c00...
```

ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ `ext_key` ã«æ ¼ç´ã•ã‚Œã‚‹ã®ã§è¿”ç­”ã¯ç„¡è¦–ã§å¤§ä¸ˆå¤«ã§ã™ã€‚

## 4. éµã®å¼·åŒ–å°å‡º

å®‰å…¨æ€§å‘ä¸Šã®ãŸã‚ã«å¼·åŒ–å°å‡ºã‚’è¡Œã„ã¾ã™ã€‚æ‹¡å¼µéµã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã« `.derive` é–¢æ•°ã‚’å®Ÿè¡Œã—ã€`ext_key1`ã«æ ¼ç´ã—ã¾ã™ã€‚

```ruby
> ext_key1 = ext_key.derive(1)
=> #<Tapyrus::ExtKey:0x00007fb29c92b7c8...
```

å¼·åŒ–å°å‡ºå¾Œã®æ‹¡å¼µéµã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ `ext_key1` ã«æ ¼ç´ã•ã‚Œã¾ã™ã€‚

## 5. å…¬é–‹éµã‚’å–å¾—

æ‹¡å¼µéµã‹ã‚‰å…¬é–‹éµã‚’å–å¾—ã—ã¾ã™ã€‚å¼·åŒ–å°å‡ºå¾Œã®æ‹¡å¼µéµã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ `ext_key1` ã® `pub` ã‚’å‚ç…§ã—ã¾ã™ã€‚

```ruby
> pub = ext_key1.pub
=> "å…¬é–‹éµ(hex)"
```

hexè¡¨ç¤ºã®å…¬é–‹éµãŒè¿”ã£ã¦ãã¾ã™ã€‚è¿”ç­”ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚

## 6. ç§˜å¯†éµã‚’å–å¾—

æ‹¡å¼µéµã‹ã‚‰ç§˜å¯†éµã‚’å–å¾—ã—ã¾ã™ã€‚å…¬é–‹éµåŒæ§˜ã®æ‰‹é †ã§ `priv` ã‚’å‚ç…§ã—ã¾ã™ã€‚

```ruby
> priv = ext_key1.priv
=> "ç§˜å¯†éµ(hex)"
```

hexè¡¨ç¤ºã®ç§˜å¯†éµãŒè¿”ã£ã¦ãã¾ã™ã€‚è¿”ç­”ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚

## 7. ç§˜å¯†éµã‚’WIFå½¢å¼ã§å–å¾—

æ‹¡å¼µéµã‹ã‚‰WIFå½¢å¼ã§ç§˜å¯†éµã‚’å–å¾—ã—ã¾ã™ã€‚

WIFã¨ã¯ Wallet Import Format ã®ç•¥ã§Bitcoinã®walletã‚’æ‰±ã†ãŸã‚ã«é–‹ç™ºã•ã‚ŒãŸéµã®è¡¨ç¤ºå½¢å¼ã§ã™ã€‚

```ruby
> wif = ext_key1.key.to_wif
=> "ç§˜å¯†éµ(WIF)"
```

WIFè¡¨ç¤ºã®ç§˜å¯†éµãŒè¿”ã£ã¦ãã¾ã™ã€‚è¿”ç­”ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚

# genesis-blockã‚’ä½œæˆ

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¸ã‚§ãƒã‚·ã‚¹ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚å…¬é–‹éµãƒ»ç§˜å¯†éµã¯å…ˆã»ã©ç”Ÿæˆã—ãŸã‚‚ã®ã‚’åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚å…¬å¼ã§ã¯-timeå¼•æ•°ã¨-addresså¼•æ•°ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãªã®ã§ä»Šå›ã¯æŒ‡å®šã—ã¾ã›ã‚“ã€‚æŒ‡å®šãŒãªã‘ã‚Œã°-timeã«ã¯ç¾åœ¨ã®Unixæ™‚é–“ãŒå…¥ã‚Šã¾ã™ã€‚

```bash
$ tapyrus-genesis -dev -signblockpubkey=å…¬é–‹éµ -signblockprivatekey=ç§˜å¯†éµ(WIF)
```

16é€²æ•°ã§è¡¨ç¤ºã•ã‚ŒãŸgenesis-blockãŒè¿”ã£ã¦ãã¾ã™ã€‚ãã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ `genesis.1905960821` ã¨ã„ã†åå‰ã§ä¿å­˜ã—ã¾ã™ã€‚

```bash
$ cd /var/lib/tapyrus-dev
$ sudo vim genesis.1905960821
```

# Coreã‚’èµ·å‹•

ä»¥ä¸Šã§èµ·å‹•æº–å‚™ã¯å®Œäº†ã§ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§CoreãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚

```bash
$ sudo tapyrusd -dev -datadir=/var/lib/tapyrus-dev -conf=/etc/tapyrus/tapyrus.conf
```

# ãŠã¾ã‘ï¼šã¡ã‚‡ã£ã¨ä½¿ã£ã¦ã¿ã‚‹

ã›ã£ã‹ããªã®ã§å°‘ã—ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

## ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½œæˆã™ã‚‹

````bash
$ sudo tapyrus-cli -conf=/etc/tapyrus/tapyrus.conf getnewaddress
````

ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä½œæˆã•ã‚Œè¿”ã£ã¦ãã¾ã™ã€‚

## ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä½œæˆã™ã‚‹

```bash
$ sudo tapyrus-cli -conf=/etc/tapyrus/tapyrus.conf generatetoaddress 1 "ã‚¢ãƒ‰ãƒ¬ã‚¹" "ç§˜å¯†éµ(WIF)"
```

ç§˜å¯†éµã«ã¤ã„ã¦ã€TapyrusCoreã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ0.4.1ã‚ˆã‚Šå¤ã„å ´åˆã¯hexã€ã‚ˆã‚Šæ–°ã—ã„å ´åˆã¯WIFã®ã‚‚ã®ã‚’æŒ‡å®šã—ã¾ã™ã€‚

## UTXOã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹

```bash
$ sudo tapyrus-cli -conf=/etc/tapyrus/tapyrus.conf listunspent
```

UTXOã®ãƒªã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

# çµ‚ã‚ã‚Š
ä»¥ä¸Šã§Tapyrus Coreã®devãƒ¢ãƒ¼ãƒ‰ãŒUbuntuä¸Šã§ç«‹ã¡ä¸ŠãŒã‚Šã¾ã—ãŸã€‚
ä»¥é™ã®é–‹ç™ºã¯[tapyrusrb](https://github.com/chaintope/tapyrusrb)ã‚„[Glueby](https://github.com/chaintope/glueby)ãªã©ã‚’ç”¨ã„ã‚‹ã¨ç°¡å˜ã«é€²ã¿ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ä»Šå›å»ºã¦ãŸTapyrus Coreã¸RPCæ¥ç¶šã—ç¨¼åƒã—ã¾ã™ã€‚


# å‚è€ƒ
https://github.com/chaintope/tapyrus-core/blob/master/doc/tapyrus/getting_started.md#how-to-start-tapyrus-in-dev-mode